# ğŸš€ Guia Definitivo: Melhores PrÃ¡ticas Claude Code 2025

## ğŸ“‹ Ãndice

1. [Fundamentos e Conceitos Essenciais](#fundamentos)
2. [PadrÃ£o agents.md: O Novo Standard da IndÃºstria](#agents-md)
3. [ConfiguraÃ§Ã£o e Setup Inicial](#setup)
4. [Workflows AvanÃ§ados](#workflows)
5. [Subagentes: Arquitetura Multi-Agente](#subagentes)
6. [Hooks e AutomaÃ§Ã£o](#hooks)
7. [Comandos Customizados](#comandos)
8. [Gerenciamento de Contexto e MemÃ³ria](#contexto)
9. [Modos de OperaÃ§Ã£o: Plan Mode vs Agentic Mode](#modos)
10. [IntegraÃ§Ã£o com Ferramentas Externas](#integracao)
11. [RefatoraÃ§Ã£o Segura e Iterativa](#refatoracao)
12. [RevisÃ£o de Pull Requests](#pr-review)
13. [SeguranÃ§a e Boas PrÃ¡ticas](#seguranca)
14. [Troubleshooting e OtimizaÃ§Ã£o](#troubleshooting)
15. [Checklists e ReferÃªncias RÃ¡pidas](#checklists)

---

## 1. Fundamentos e Conceitos Essenciais {#fundamentos}

### O que Ã© Claude Code?

O Claude Code Ã© uma ferramenta de assistÃªncia de codificaÃ§Ã£o por IA desenvolvida pela Anthropic que atua como um "par programador" direto no seu fluxo de trabalho. Diferente de assistentes de cÃ³digo convencionais:

- **Executa aÃ§Ãµes reais**: cria arquivos, modifica cÃ³digo, executa testes
- **Opera via linha de comando ou IDE**: integraÃ§Ã£o profunda com VS Code, Cursor e JetBrains
- **Gerencia projetos completos**: nÃ£o apenas sugere trechos, mas implementa features inteiras
- **Possui 17+ ferramentas nativas**: readFile, runCommand, webSearch, task (subagentes), etc.

### Modelos DisponÃ­veis

#### Claude 4 Sonnet
- âœ… **Recomendado para uso diÃ¡rio**
- âš¡ Mais rÃ¡pido e estÃ¡vel
- ğŸ’° ~1/5 do custo do Opus
- ğŸ¯ Excelente para 95% das tarefas
- ğŸ“Š Supera GPT-4 em vÃ¡rios benchmarks

#### Claude 4 Opus
- ğŸ§  MÃ¡ximo raciocÃ­nio e inteligÃªncia
- ğŸ¢ 5Ã— mais lento que Sonnet
- ğŸ’¸ 5Ã— mais caro que Sonnet
- âš ï¸ Pode ter instabilidades de uptime
- ğŸ¯ Use apenas para tarefas extremamente complexas

**Regra de Ouro**: Comece sempre com Sonnet. SÃ³ mude para Opus se:
- Sonnet falhou em resolver o problema
- Tarefa requer raciocÃ­nio arquitetural profundo
- AnÃ¡lise de cÃ³digo extremamente complexa

---

## 2. PadrÃ£o agents.md: O Novo Standard da IndÃºstria {#agents-md}

### ğŸ¯ Por que agents.md?

O `agents.md` Ã© um **padrÃ£o aberto** proposto para substituir arquivos proprietÃ¡rios fragmentados:
- âŒ Antes: `.cursor-rules`, `claude.md`, `.copilot-instructions` (incompatÃ­veis)
- âœ… Agora: `agents.md` (universal, suportado por OpenAI, Google Jules, Cursor)

**Status Atual (2025)**: 
- âœ… Adotado por: OpenAI, Google (Jules), Cursor, AMP Code
- â³ Pendente: Anthropic Claude, Gemini CLI

### ğŸ“ Estrutura do agents.md

```markdown
# Project Overview
Brief description of what this project does and its main technologies.

## Tech Stack
- Frontend: React 18, Next.js 14
- Backend: Node.js, Express
- Database: PostgreSQL 14
- Testing: Jest, Playwright

## Environment Setup
1. Install Node.js v18+
2. Run: `npm install`
3. Copy `.env.example` to `.env`

## Build & Test Commands
### Build
```bash
npm run build
```

### Run Tests
```bash
# Run all tests - ALWAYS run after making changes
npm test

# Run specific test suite
npm test -- path/to/test
```

## Code Style Guidelines
- Use TypeScript strict mode
- Follow ESLint rules in `.eslintrc.js`
- Max line length: 100 characters
- Prefer functional components over class components

## Security Considerations
- Never commit secrets or API keys
- Sanitize all user inputs
- Use parameterized queries for database operations
- Validate environment variables on startup

## Commit Message Format
Follow Conventional Commits:
- `feat:` new feature
- `fix:` bug fix
- `docs:` documentation only
- `refactor:` code restructure without behavior change
```

### ğŸ¯ Uso em Monorepos

Para projetos grandes, use **arquivos aninhados**:

```
/
â”œâ”€â”€ agents.md                 # Regras globais
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ agents.md        # Regras especÃ­ficas da API
â”‚   â””â”€â”€ frontend/
â”‚       â””â”€â”€ agents.md        # Regras especÃ­ficas do frontend
```

**PrecedÃªncia**: O arquivo mais prÃ³ximo do cÃ³digo sendo editado sempre vence.

### âœ… Checklist de MigraÃ§Ã£o

- [ ] Renomear arquivos existentes (`.cursor-rules` â†’ `agents.md`)
- [ ] Adicionar comandos de teste obrigatÃ³rios
- [ ] Incluir setup de ambiente completo
- [ ] Documentar stack tecnolÃ³gica
- [ ] Definir guidelines de seguranÃ§a
- [ ] Versionar no Git junto com cÃ³digo

---

## 3. ConfiguraÃ§Ã£o e Setup Inicial {#setup}

### ğŸ“¦ InstalaÃ§Ã£o

#### Via npm (Global)
```bash
npm install -g @anthropic-ai/claude-code
```

#### Via IDE (Recomendado)

**VS Code / Cursor**:
1. Abrir Extensions Marketplace
2. Buscar "Claude Code"
3. Instalar extensÃ£o oficial
4. Reiniciar IDE

**JetBrains IDEs**:
1. Settings â†’ Plugins
2. Buscar "Claude Code"
3. Instalar e reiniciar

### ğŸ” AutenticaÃ§Ã£o

#### OpÃ§Ã£o 1: Conta Anthropic
```bash
claude  # Primeira execuÃ§Ã£o abre login no navegador
```

#### OpÃ§Ã£o 2: API Key
```bash
# Linux/Mac
export ANTHROPIC_API_KEY="sk-ant-..."

# Windows (PowerShell)
$env:ANTHROPIC_API_KEY="sk-ant-..."

# Persistente (adicionar ao ~/.bashrc ou ~/.zshrc)
echo 'export ANTHROPIC_API_KEY="sk-ant-..."' >> ~/.bashrc
```

### ğŸ¬ InicializaÃ§Ã£o de Projeto

```bash
cd /caminho/do/projeto
claude
```

**Primeiro comando SEMPRE**:
```bash
/init
```

O `/init` irÃ¡:
1. âœ… Analisar estrutura do projeto
2. âœ… Identificar dependÃªncias
3. âœ… Criar arquivo `.claude.md` (ou usar `agents.md` se existir)
4. âœ… Mapear tech stack
5. âœ… Preparar contexto inicial

### âš™ï¸ ConfiguraÃ§Ãµes Recomendadas

#### .claude/settings.json
```json
{
  "diffView": "auto",
  "autoUpdate": false,
  "model": "claude-sonnet-4",
  "hooks": {},
  "customCommands": {}
}
```

**Dica**: Desativar `autoUpdate` evita surpresas com versÃµes instÃ¡veis.

---

## 4. Workflows AvanÃ§ados {#workflows}

### ğŸ¯ Workflow 1: Spec-Driven Development

Este Ã© o **workflow mais recomendado** para features complexas.

#### Fase 1: Planejamento
```bash
# Entrar em Plan Mode
Shift + Tab  # No Cursor/IDE

# Ou adicionar ao .claude.md:
```

Adicionar ao `.claude.md`:
```markdown
## Development Workflow
IMPORTANT: Before implementing ANY feature:
1. Create a detailed plan in a markdown file
2. Get approval from user
3. Only then proceed with implementation
```

#### Fase 2: ExecuÃ§Ã£o
```
> Crie um plano detalhado para implementar autenticaÃ§Ã£o JWT
```

Claude Code irÃ¡:
1. Criar arquivo `auth-jwt-plan.md`
2. Detalhar fases de implementaÃ§Ã£o
3. Identificar arquivos a modificar
4. Listar testes necessÃ¡rios

#### Fase 3: ImplementaÃ§Ã£o por Fases
```
> Vamos implementar a Fase 1: ConfiguraÃ§Ã£o de dependÃªncias
```

### ğŸ¯ Workflow 2: Multi-Agent Setup

**Use Case**: Projetos grandes onde diferentes agentes focam em Ã¡reas especÃ­ficas.

#### Setup
```bash
# Terminal 1 - Backend Agent
claude
> VocÃª Ã© o Agent Backend. Foque apenas em API e banco de dados.

# Terminal 2 - Frontend Agent  
claude
> VocÃª Ã© o Agent Frontend. Foque apenas em componentes React.

# Terminal 3 - Testing Agent
claude
> VocÃª Ã© o Agent Testing. Foque apenas em testes e QA.
```

#### Arquivo de ComunicaÃ§Ã£o: coms.md
```markdown
# Agent Communication Log

## Current Status
- Backend: Implementando endpoint /api/users
- Frontend: Aguardando API estar pronta
- Testing: Escrevendo testes unitÃ¡rios para UserService

## Completed Tasks
- [Backend] Setup database migrations
- [Backend] Created User model
- [Frontend] Created UserProfile component skeleton

## Blocked/Waiting
- [Frontend] Bloqueado: aguardando endpoint /api/users
```

**InstruÃ§Ã£o para cada agent**:
```
Antes de cada tarefa, leia coms.md. ApÃ³s completar, atualize seu status no coms.md.
```

### ğŸ¯ Workflow 3: Pull Request Review

#### Prompt Especializado

```markdown
This is the pull request I need you to review. Pay attention because this is 
a very important change. 

**PROCESS**:

**Stage 1 - Understanding**:
1. Execute: `gh pr view [PR_NUMBER]`
2. Read the title and description
3. Summarize: What is the PR trying to achieve?

**Stage 2 - Preparation**:
1. Execute: `gh pr checkout [PR_NUMBER]`
2. List all changed files
3. Note which parts of the system are affected

**Stage 3 - Manual Testing**:
1. Install dependencies if needed
2. Run the application
3. Test the new feature manually
4. Verify nothing broke

**Stage 4 - Code Analysis**:
For each file changed:
1. Open the file
2. Explain what changed and why
3. Identify potential issues:
   - Logic errors
   - Security vulnerabilities
   - Performance concerns
   - Missing error handling
   - Lack of tests

**Final Output**:
- Summary of changes
- List of concerns (if any)
- Recommendation: Approve / Request Changes / Needs Discussion

Answer in short but complete.
```

---

## 5. Subagentes: Arquitetura Multi-Agente {#subagentes}

### ğŸ¤– O que sÃ£o Subagentes?

Subagentes sÃ£o **versÃµes especializadas** do Claude Code que:
- âœ… Operam em **janela de contexto isolada**
- âœ… Possuem ferramentas especÃ­ficas limitadas
- âœ… Retornam apenas resumo ao agente principal
- âœ… Podem ser reutilizados infinitas vezes

### ğŸ“Š ComparaÃ§Ã£o: Subagentes vs Comandos Customizados

| Aspecto | Comandos Customizados | Subagentes |
|---------|----------------------|------------|
| Contexto | Compartilhado (polui) | Isolado (limpo) |
| Ferramentas | Todas disponÃ­veis | Seletivas |
| Consumo de tokens | Alto | Otimizado |
| ReutilizaÃ§Ã£o | Sim | Sim |
| SeguranÃ§a | Menor controle | Maior controle |

### ğŸ¯ Criando um Subagente

```bash
/agents new
```

**OpÃ§Ãµes**:
1. **Project Agent**: DisponÃ­vel apenas neste projeto
   - Salvo em `.claude/agents/`
2. **Personal Agent**: DisponÃ­vel globalmente
   - Salvo em `~/.claude/agents/`

### ğŸ“ Exemplo: ShadCN UI Builder

```markdown
# Agent Name
ShadCN UI Builder

# Description
Expert in building modern React UIs using ShadCN components and Next.js.
Automatically invoked when user asks for UI implementation with ShadCN.

# System Prompt
You are a specialized UI development agent. Your role:
1. Build React components using ShadCN UI library
2. Follow Next.js 14 app router conventions
3. Use Tailwind CSS for styling
4. Ensure accessibility (ARIA labels, keyboard navigation)
5. Create responsive designs (mobile-first)

## Workflow
1. Read design specs from provided file
2. Install necessary ShadCN components
3. Create component structure
4. Implement functionality
5. Add proper TypeScript types
6. Write brief usage documentation

## Constraints
- NEVER modify files outside /components or /app directories
- ALWAYS use TypeScript strict mode
- MUST include responsive breakpoints

# Tools Allowed
[x] readFile
[x] writeFile
[x] runCommand
[ ] webSearch (not needed)
[ ] deleteFile (too dangerous)
```

### ğŸ”„ Invocando Subagentes

#### AutomÃ¡tica (Baseada em DescriÃ§Ã£o)
```
> Crie uma pÃ¡gina de dashboard usando componentes ShadCN
```
â†’ Claude Code automaticamente detecta e ativa "ShadCN UI Builder"

#### Manual (ExplÃ­cita)
```
> @ShadCN-UI-Builder implemente a tela de login
```

### ğŸ”— Encadeamento de Subagentes

**Use Case**: Workflow complexo multi-etapa

#### Criar Comando Customizado
`.cloud/commands/full-feature.md`:
```markdown
Execute this workflow:

1. Call @Code-Analyzer to analyze the current codebase
2. Wait for analysis completion
3. Call @Feature-Implementer with the analysis results
4. Wait for implementation
5. Call @Test-Writer to create tests for new code
6. Run all tests
7. If tests pass, call @Documenter to update documentation
```

Uso:
```bash
/full-feature implement user authentication
```

---

## 6. Hooks e AutomaÃ§Ã£o {#hooks}

### ğŸ¯ O que sÃ£o Hooks?

Hooks permitem **executar aÃ§Ãµes automÃ¡ticas** quando eventos especÃ­ficos ocorrem:

- `pre-tool-use`: Antes de executar qualquer ferramenta
- `post-tool-use`: ApÃ³s usar uma ferramenta
- `on-stop`: Quando tarefa Ã© concluÃ­da
- `on-error`: Quando ocorre um erro

### ğŸ”§ Configurando Hooks

#### Via Interface
```bash
/hooks
```

#### Via JSON (`.claude/settings.json`)
```json
{
  "hooks": {
    "post-tool-use": [
      {
        "matcher": "Write|Edit|MultiEdit",
        "hooks": [
          {
            "type": "command",
            "command": "python3 .claude/hooks/typecheck.py"
          }
        ]
      }
    ],
    "on-stop": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "afplay /System/Library/Sounds/Glass.aiff"
          }
        ]
      }
    ]
  }
}
```

### ğŸ“ Exemplo: Type Check AutomÃ¡tico

`.claude/hooks/typecheck.py`:
```python
#!/usr/bin/env python3
import sys
import json
import subprocess

# Receber dados do hook via stdin
hook_data = json.load(sys.stdin)
tool_output = hook_data.get('tool_output', {})
files = tool_output.get('files', [])

# Verificar cada arquivo TypeScript modificado
for file_path in files:
    if file_path.endswith(('.ts', '.tsx')):
        result = subprocess.run(
            ['npx', 'tsc', '--noEmit', '--strict', file_path],
            capture_output=True,
            text=True
        )
        
        if result.returncode != 0:
            print(f"âŒ Type check failed for {file_path}:", file=sys.stderr)
            print(result.stderr, file=sys.stderr)
            sys.exit(2)  # Exit code 2 = bloqueio

print("âœ… All type checks passed")
sys.exit(0)
```

Tornar executÃ¡vel:
```bash
chmod +x .claude/hooks/typecheck.py
```

### ğŸ¯ Hook: NotificaÃ§Ã£o Sonora

#### macOS
```json
{
  "hooks": {
    "on-stop": [{
      "matcher": "*",
      "hooks": [{
        "type": "command",
        "command": "afplay /System/Library/Sounds/Glass.aiff"
      }]
    }]
  }
}
```

#### Linux
```bash
paplay /usr/share/sounds/freedesktop/stereo/complete.oga
```

#### Windows (PowerShell)
```powershell
[console]::beep(800,300)
```

### âš¡ Hooks AvanÃ§ados

#### Auto-formatter
```json
{
  "hooks": {
    "post-tool-use": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "npm run format"
          }
        ]
      }
    ]
  }
}
```

#### Security Scan
```json
{
  "hooks": {
    "post-tool-use": [
      {
        "matcher": "Write",
        "hooks": [
          {
            "type": "command",
            "command": "semgrep --config auto ."
          }
        ]
      }
    ]
  }
}
```

---

## 7. Comandos Customizados {#comandos}

### ğŸ¯ Criando Comandos

**Estrutura**:
```
.cloud/
â””â”€â”€ commands/
    â”œâ”€â”€ analyze.md
    â”œâ”€â”€ optimize.md
    â””â”€â”€ joke.md
```

### ğŸ“ Exemplo 1: AnÃ¡lise de CÃ³digo

`.cloud/commands/analyze.md`:
```markdown
Execute a deep code analysis of the current file:

1. **Complexity Analysis**:
   - Identify functions with cyclomatic complexity > 10
   - Flag deeply nested code (> 4 levels)
   - Detect long functions (> 50 lines)

2. **Code Quality**:
   - Check for code duplication
   - Identify magic numbers and hard-coded values
   - Look for missing error handling

3. **Performance Concerns**:
   - Spot potential performance bottlenecks
   - Identify inefficient algorithms
   - Check for unnecessary re-renders (React)

4. **Security Issues**:
   - Look for SQL injection vulnerabilities
   - Check for XSS vulnerabilities
   - Identify exposed secrets or API keys

Provide actionable recommendations with code examples.
```

Uso:
```bash
/analyze
```

### ğŸ“ Exemplo 2: Gerador de Testes

`.cloud/commands/test-gen.md`:
```markdown
Generate comprehensive unit tests for the current file:

1. **Test Structure**:
   - Use Jest/Vitest framework
   - Follow AAA pattern (Arrange, Act, Assert)
   - One test file per source file

2. **Coverage Goals**:
   - Test all public functions
   - Include edge cases (empty input, null, undefined)
   - Test error scenarios
   - Mock external dependencies

3. **Test Quality**:
   - Use descriptive test names
   - Keep tests isolated (no shared state)
   - Avoid testing implementation details

4. **Output**:
   - Create test file with `.test.ts` or `.spec.ts` extension
   - Place in `__tests__` directory or alongside source file
```

### ğŸ“ Exemplo 3: DocumentaÃ§Ã£o AutomÃ¡tica

`.cloud/commands/doc-gen.md`:
```markdown
Generate comprehensive documentation for the current code:

1. **JSDoc Comments**:
   - Add JSDoc to all functions
   - Include @param, @returns, @throws
   - Add examples for complex functions

2. **README Section**:
   - Create usage example
   - List dependencies
   - Explain main concepts

3. **Inline Comments**:
   - Add comments for complex logic
   - Explain WHY, not WHAT
   - Keep comments up to date with code
```

### ğŸ”¥ Pacote: Supercloud

Instalar:
```bash
npm install -g @supercloud/cli
```

Comandos disponÃ­veis:
- `/sc-analyze`: AnÃ¡lise profunda de arquitetura
- `/workflow`: Segue um PRD passo a passo
- `/optimize`: SugestÃµes de otimizaÃ§Ã£o
- `/security`: Scan de vulnerabilidades

---

## 8. Gerenciamento de Contexto e MemÃ³ria {#contexto}

### ğŸ“ Arquivo de Contexto: .claude.md

O `.claude.md` (ou `agents.md`) Ã© o **cÃ©rebro persistente** do projeto.

```markdown
# Project Context

## Tech Stack
- Next.js 14 (App Router)
- React 18
- TypeScript 5
- Tailwind CSS
- PostgreSQL
- Prisma ORM

## Key Decisions
- Using Server Components by default
- API routes only for external webhooks
- Database queries via Prisma Client Extensions

## Active Constraints
- Max bundle size: 200KB per route
- All components must be fully typed
- No inline styles (use Tailwind only)

## Common Patterns
### API Error Handling
```typescript
try {
  // operation
} catch (error) {
  return NextResponse.json(
    { error: error.message },
    { status: 500 }
  )
}
```

## Important Files
- `/lib/db.ts`: Database connection
- `/lib/auth.ts`: Authentication logic
- `/app/api/*/route.ts`: API endpoints
```

### ğŸ”„ Comandos de Contexto

#### Resumir Conversa Longa
```bash
/compact
```
Gera sumÃ¡rio e libera espaÃ§o no contexto.

#### Retomar SessÃ£o
```bash
/resume <nome-ou-id>
```

#### Ver HistÃ³rico
```bash
/history
```

#### Limpar Contexto
```bash
/clear
```
âš ï¸ **AtenÃ§Ã£o**: Apaga histÃ³rico, mas mantÃ©m `.claude.md`

### ğŸ’¾ Modo MemÃ³ria

#### Sintaxe
```bash
# Este Ã© um comentÃ¡rio de memÃ³ria
# A IA lembrarÃ¡ disso nas prÃ³ximas interaÃ§Ãµes
# VersÃ£o da API atual: v2.1
```

#### Uso PrÃ¡tico
```bash
# UsuÃ¡rio prefere cÃ³digo verboso e bem comentado
# Sempre usar async/await ao invÃ©s de .then()
# Priorizar performance sobre legibilidade neste projeto
```

### ğŸ§  Limites de Contexto

| Modelo | Janela de Contexto | Uso Recomendado |
|--------|-------------------|------------------|
| Sonnet 4 | ~100K tokens | 95% dos casos |
| Opus 4 | ~100K tokens | Tarefas complexas |

**1 token â‰ˆ 0.75 palavras**
**100K tokens â‰ˆ 75K palavras â‰ˆ 300 pÃ¡ginas**

---

## 9. Modos de OperaÃ§Ã£o: Plan Mode vs Agentic Mode {#modos}

### ğŸ“‹ Plan Mode (Planejamento)

#### AtivaÃ§Ã£o
- **Cursor**: `Shift + Tab`
- **CLI**: Adicionar regra ao `.claude.md`

```markdown
## Workflow Rule
CRITICAL: For ANY new feature:
1. First create a detailed plan
2. Save plan to `plans/<feature-name>.md`
3. Wait for user approval
4. Only then implement
```

#### Comportamento
- ğŸ” Prioriza pesquisa e anÃ¡lise
- ğŸ“ Cria especificaÃ§Ãµes detalhadas
- âŒ **NÃƒO** executa comandos destrutivos
- âœ… Gera planos em Markdown

#### Quando Usar
- âœ… InÃ­cio de features complexas
- âœ… RefatoraÃ§Ãµes grandes
- âœ… Arquitetura de novos mÃ³dulos
- âœ… AnÃ¡lise de problemas difÃ­ceis

### âš¡ Agentic Mode (ExecuÃ§Ã£o)

#### AtivaÃ§Ã£o
- Modo padrÃ£o apÃ³s sair do Plan Mode
- Ou comando: `/autoapprove`

#### Comportamento
- ğŸš€ Executa aÃ§Ãµes automaticamente
- ğŸ“ Modifica arquivos
- ğŸ”§ Roda comandos
- âœ… Implementa cÃ³digo

#### Quando Usar
- âœ… ApÃ³s plano aprovado
- âœ… Tarefas bem definidas
- âœ… ImplementaÃ§Ãµes diretas
- âœ… Ajustes menores

### ğŸ”„ Workflow Recomendado

```
1. [Plan Mode] â†’ Criar plano detalhado
2. [Humano]    â†’ Revisar e aprovar plano
3. [Agentic]   â†’ Implementar Fase 1
4. [Humano]    â†’ Testar Fase 1
5. [Agentic]   â†’ Implementar Fase 2
6. [Humano]    â†’ Testar Fase 2
... repetir atÃ© conclusÃ£o
```

---

## 10. IntegraÃ§Ã£o com Ferramentas Externas {#integracao}

### ğŸ”Œ MCP (Model Context Protocol)

#### Conectar GitHub
```bash
/mcp add github
```

Configurar:
```json
{
  "mcpServers": {
    "github": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-github"],
      "env": {
        "GITHUB_PERSONAL_ACCESS_TOKEN": "ghp_..."
      }
    }
  }
}
```

#### Conectar Google Drive
```bash
/mcp add google-drive
```

### ğŸ¨ Cursor IDE

**Vantagens**:
- âœ… Atalho rÃ¡pido: `Ctrl+Esc` (Windows) / `Cmd+Esc` (Mac)
- âœ… Visual diff integrado
- âœ… Compartilhamento automÃ¡tico de seleÃ§Ã£o
- âœ… Max Mode (contexto gigante)

**Setup**:
1. Instalar Cursor IDE
2. Instalar extensÃ£o Claude Code
3. Abrir projeto
4. `Ctrl+Esc` para ativar

### ğŸ—£ï¸ SuperWhisper (Speech-to-Text)

**Use Case**: Ditar prompts longos por voz

Setup:
1. Instalar SuperWhisper
2. Configurar hotkey global
3. Falar â†’ transcriÃ§Ã£o automÃ¡tica â†’ envio ao Claude

### ğŸ” cc undo (Versionamento)

**Problema**: Claude Code nÃ£o tem "undo" nativo

**SoluÃ§Ã£o**: Pacote `cc undo`

```bash
npm install -g cc-undo
```

Uso:
```bash
# Listar alteraÃ§Ãµes
cc undo list

# Preview de mudanÃ§a
cc undo preview <id>

# Desfazer alteraÃ§Ã£o
cc undo apply <id>
```

---

## 11. RefatoraÃ§Ã£o Segura e Iterativa {#refatoracao}

### ğŸ¯ Metodologia: 3 Fases CirÃºrgicas

#### Fase 1: Safety Net (Rede de SeguranÃ§a)
```bash
> Antes de qualquer refatoraÃ§Ã£o deste arquivo:
> 1. Crie testes abrangentes cobrindo TODA funcionalidade existente
> 2. Execute os testes e garanta 100% de passa
> 3. Documente o comportamento atual
> 4. SÃ³ entÃ£o me avise que podemos prosseguir
```

**Objetivo**: Garantir que podemos detectar qualquer quebra.

#### Fase 2: Surgical Planning (Planejamento CirÃºrgico)
```bash
> Analise o cÃ³digo e:
> 1. Identifique "hotspots" de complexidade (funÃ§Ãµes > 50 linhas, alta cyclomatic complexity)
> 2. Ranqueie por risco: menor â†’ maior
> 3. Crie um plano de extraÃ§Ã£o em ordem de risco crescente
> 4. Para cada item, explique COMO serÃ¡ extraÃ­do e ONDE irÃ¡
```

**Output esperado**: `refactor-plan.md` com ordem de execuÃ§Ã£o.

#### Fase 3: Incremental Execution (ExecuÃ§Ã£o Incremental)
```bash
> Execute o plano item por item:
> 1. Extraia apenas 40-60 linhas por vez
> 2. ApÃ³s cada extraÃ§Ã£o:
>    - Execute TODOS os testes
>    - Se falhar, REVERTA e tente abordagem diferente
>    - Se passar, commite a mudanÃ§a
> 3. Continue para prÃ³ximo item
```

### ğŸ“‹ Exemplo Completo

**Arquivo original**: `UserService.ts` (1200 linhas, complexidade 47)

```typescript
// Phase 1: Safety Net
> Crie testes completos para UserService.ts

// Phase 2: Planning
> Crie plano de refatoraÃ§Ã£o para UserService.ts

// Output: refactor-plan.md
```

```markdown
# UserService Refactoring Plan

## Risk Assessment
- Total Lines: 1200
- Cyclomatic Complexity: 47
- Dependencies: 23

## Extraction Order (Lowâ†’High Risk)

### 1. Validation Functions (Low Risk)
**Lines**: 45-120
**Complexity**: 8
**Target**: `validators/user-validator.ts`
**Dependencies**: None
**Tests**: Isolated, easy to test

### 2. Database Queries (Medium Risk)
**Lines**: 200-350
**Complexity**: 15
**Target**: `repositories/user-repository.ts`
**Dependencies**: Prisma client
**Tests**: Requires DB mocks

### 3. Business Logic (High Risk)
**Lines**: 400-800
**Complexity**: 24
**Target**: `services/user-business-logic.ts`
**Dependencies**: Multiple services
**Tests**: Complex integration tests
```

```typescript
// Phase 3: Execution
> Execute item 1 do plano de refatoraÃ§Ã£o

// ApÃ³s cada extraÃ§Ã£o:
> Execute npm test e me informe resultados
```

### âœ… Checklist de RefatoraÃ§Ã£o

- [ ] Testes existentes passando 100%
- [ ] Nova estrutura de arquivos definida
- [ ] Plano de extraÃ§Ã£o em ordem de risco
- [ ] Cada extraÃ§Ã£o â‰¤ 60 linhas
- [ ] Testes executados apÃ³s cada passo
- [ ] Commits pequenos e frequentes
- [ ] DocumentaÃ§Ã£o atualizada

---

## 12. RevisÃ£o de Pull Requests {#pr-review}

### ğŸ¯ Template de Prompt

```markdown
# PR Review Process

This PR: #[NUMBER]

## Stage 1: Understanding (5 min)
Execute:
```bash
gh pr view [NUMBER]
gh pr diff [NUMBER]
```

Questions:
1. What is the main purpose of this PR?
2. Which parts of the system are affected?
3. Are there any breaking changes?

## Stage 2: Checkout & Build (5 min)
```bash
gh pr checkout [NUMBER]
npm install
npm run build
```

Verify:
- [ ] Build succeeds without errors
- [ ] No new warnings

## Stage 3: Manual Testing (10 min)
1. Start application
2. Test new functionality
3. Test existing functionality (regression)
4. Check edge cases

Document findings:
- What works as expected?
- What doesn't work?
- Any unexpected behavior?

## Stage 4: Code Analysis (15 min)

For EACH changed file:

### Code Quality
- Is code readable and maintainable?
- Are there complex functions that should be split?
- Is there code duplication?

### Logic & Correctness
- Does the logic make sense?
- Are there edge cases not handled?
- Could this fail in production?

### Performance
- Are there inefficient operations?
- Could this cause memory leaks?
- Are database queries optimized?

### Security
- Is user input sanitized?
- Are there SQL injection risks?
- Are secrets properly managed?

### Testing
- Are there unit tests?
- Do tests cover edge cases?
- Are integration tests needed?

## Final Report

### Summary
[Brief description of changes]

### Strengths
- [What was done well]

### Concerns
1. [Critical issues to fix]
2. [Important issues to consider]
3. [Nice-to-have improvements]

### Recommendation
[ ] âœ… Approve
[ ] ğŸ”„ Request Changes
[ ] ğŸ’¬ Needs Discussion

### Next Steps
[What should happen next]
```

### ğŸš€ Uso RÃ¡pido

```bash
# Salvar template em comando
# .cloud/commands/review-pr.md

# Usar
/review-pr 1234
```

---

## 13. SeguranÃ§a e Boas PrÃ¡ticas {#seguranca}

### ğŸ” PrincÃ­pios Fundamentais

#### 1. Nunca Commitar Secrets
```markdown
# Adicionar ao .claude.md ou agents.md

## SECURITY RULES - CRITICAL

âŒ NEVER commit:
- API keys
- Database passwords
- JWT secrets
- OAuth tokens
- Private keys

âœ… ALWAYS use:
- Environment variables (.env)
- Secret management services
- .gitignore for sensitive files
```

#### 2. Validar Entrada do UsuÃ¡rio
```typescript
// Exemplo de validaÃ§Ã£o segura
import { z } from 'zod';

const userSchema = z.object({
  email: z.string().email(),
  age: z.number().min(18).max(120),
  username: z.string().min(3).max(50).regex(/^[a-zA-Z0-9_]+$/)
});

// Usar em handlers
try {
  const validated = userSchema.parse(input);
} catch (error) {
  return { error: 'Invalid input' };
}
```

#### 3. Sanitizar Queries SQL
```typescript
// âŒ PERIGOSO
const query = `SELECT * FROM users WHERE email = '${email}'`;

// âœ… SEGURO
const user = await db.user.findUnique({
  where: { email }
});
```

### ğŸ›¡ï¸ Configurar Hooks de SeguranÃ§a

`.claude/hooks/security-scan.sh`:
```bash
#!/bin/bash

echo "ğŸ” Running security scan..."

# Check for hardcoded secrets
if grep -r "API_KEY\s*=\s*['\"]" . --exclude-dir=node_modules; then
    echo "âŒ Found hardcoded API key!"
    exit 2
fi

# Check for SQL injection patterns
if grep -r "SELECT.*FROM.*WHERE.*\${" . --include="*.ts" --include="*.js"; then
    echo "âŒ Potential SQL injection found!"
    exit 2
fi

# Run Semgrep
npx semgrep --config auto . --quiet

echo "âœ… Security scan passed"
exit 0
```

Configurar hook:
```json
{
  "hooks": {
    "post-tool-use": [{
      "matcher": "Write|Edit",
      "hooks": [{
        "type": "command",
        "command": ".claude/hooks/security-scan.sh"
      }]
    }]
  }
}
```

### ğŸ”’ PermissÃµes Granulares

**PrincÃ­pio do Menor PrivilÃ©gio**:
```bash
# Ao criar subagente, desmarcar ferramentas nÃ£o necessÃ¡rias
/agents new

# Desmarcar:
[ ] deleteFile     # Muito destrutivo
[ ] runCommand     # Se nÃ£o precisa executar shell
[ ] webSearch      # Se trabalha apenas localmente
```

### ğŸ“‹ Checklist de SeguranÃ§a

- [ ] Nenhum secret commitado
- [ ] `.env` no `.gitignore`
- [ ] ValidaÃ§Ã£o de input em todos endpoints
- [ ] Queries parametrizadas (sem string concatenation)
- [ ] HTTPS em todas APIs externas
- [ ] Rate limiting implementado
- [ ] Logs nÃ£o expÃµem dados sensÃ­veis
- [ ] DependÃªncias atualizadas (sem vulnerabilidades conhecidas)

---

## 14. Troubleshooting e OtimizaÃ§Ã£o {#troubleshooting}

### ğŸ› Problemas Comuns

#### Problema 1: "Context window exceeded"

**Sintomas**:
- Erro ao enviar prompt longo
- Modelo para de responder

**SoluÃ§Ãµes**:
```bash
# 1. Compactar histÃ³rico
/compact

# 2. Limpar contexto e recomeÃ§ar
/clear

# 3. Usar subagentes para tarefas especÃ­ficas
/agents new

# 4. Dividir tarefa em etapas menores
> FaÃ§a apenas a Fase 1 por enquanto
```

#### Problema 2: CÃ³digo gerado nÃ£o funciona

**DiagnÃ³stico**:
```bash
# Ver detalhes da execuÃ§Ã£o
Ctrl + R  # Expande log de aÃ§Ãµes
```

**SoluÃ§Ãµes**:
```bash
# 1. Fornecer mais contexto
> Revise o cÃ³digo considerando que usamos Next.js 14 App Router

# 2. Pedir anÃ¡lise de erro
> Por que este cÃ³digo falhou? Analise o erro: [colar erro]

# 3. Refazer de forma iterativa
> RefaÃ§a apenas a funÃ§Ã£o X, mantendo o resto intacto
```

#### Problema 3: IA modifica arquivos errados

**PrevenÃ§Ã£o**:
```markdown
# Adicionar ao .claude.md

## CRITICAL CONSTRAINTS

You MUST ONLY modify files in:
- /src
- /components  
- /lib

You MUST NEVER modify:
- /node_modules
- /.git
- /build
- /dist
- Any test fixtures in /__mocks__
```

**RecuperaÃ§Ã£o**:
```bash
# Usar cc undo
cc undo list
cc undo apply <id>

# Ou Git
git status
git checkout -- <arquivo>
```

#### Problema 4: Performance lenta

**Causas**:
- Modelo Opus (mais lento)
- Projeto muito grande
- Muitos arquivos no contexto

**SoluÃ§Ãµes**:
```bash
# 1. Mudar para Sonnet
/model sonnet

# 2. Limitar escopo
> Trabalhe apenas nos arquivos em /src/auth

# 3. Usar .claudeignore
# Criar .claudeignore (similar ao .gitignore)
node_modules/
dist/
*.log
*.lock
```

### âš¡ OtimizaÃ§Ãµes de Performance

#### 1. .claudeignore Bem Configurado
```
# Dependencies
node_modules/
vendor/

# Build outputs
dist/
build/
.next/
out/

# Logs
*.log
logs/

# Lock files
package-lock.json
yarn.lock
pnpm-lock.yaml

# OS files
.DS_Store
Thumbs.db

# IDE
.vscode/
.idea/

# Large assets
*.mp4
*.mov
*.zip
*.tar.gz
```

#### 2. Usar Task para Arquivos Grandes
```bash
> Use a ferramenta task para ler o arquivo logs/production.log 
> e me diga se hÃ¡ erros relacionados a autenticaÃ§Ã£o
```

Isso cria um subagente que:
- LÃª o arquivo isoladamente
- Retorna apenas resumo relevante
- NÃ£o polui contexto principal

#### 3. Prompt Caching
```bash
# Reusar prompts comuns
# Claude API automaticamente cacheia prompts repetidos
# Reduz latÃªncia em 50-80%
```

---

## 15. Checklists e ReferÃªncias RÃ¡pidas {#checklists}

### âœ… Checklist: Novo Projeto

- [ ] Instalar Claude Code (`npm install -g @anthropic-ai/claude-code`)
- [ ] Autenticar (API key ou login Anthropic)
- [ ] Criar `agents.md` na raiz
- [ ] Executar `/init`
- [ ] Configurar hooks de seguranÃ§a
- [ ] Criar `.claudeignore`
- [ ] Adicionar comando `/review-pr`
- [ ] Configurar subagentes especializados
- [ ] Testar workflow de desenvolvimento
- [ ] Documentar padrÃµes da equipe

### âœ… Checklist: Nova Feature

- [ ] Criar issue/ticket descrevendo feature
- [ ] Ativar Plan Mode (`Shift + Tab`)
- [ ] Gerar plano detalhado
- [ ] Revisar e aprovar plano
- [ ] Implementar Fase 1
- [ ] Testar Fase 1
- [ ] Commit Fase 1
- [ ] Repetir para cada fase
- [ ] Code review (humano ou `/review-pr`)
- [ ] Merge para main

### âœ… Checklist: RefatoraÃ§Ã£o

- [ ] Criar branch de refatoraÃ§Ã£o
- [ ] Executar Fase 1: Safety Net (testes)
- [ ] Executar Fase 2: Surgical Planning
- [ ] Revisar plano de refatoraÃ§Ã£o
- [ ] Executar Fase 3: Incremental Execution
- [ ] Verificar testes apÃ³s cada passo
- [ ] Commit apÃ³s cada extraÃ§Ã£o bem-sucedida
- [ ] Code review final
- [ ] Merge

### ğŸ“‹ Comandos Essenciais - ReferÃªncia RÃ¡pida

```bash
# InicializaÃ§Ã£o
/init                    # Analisar projeto
/ide                     # Conectar ao IDE

# Contexto
/clear                   # Limpar histÃ³rico
/compact                 # Resumir conversa
/resume <id>             # Retomar sessÃ£o

# Modelos
/model sonnet           # Mudar para Sonnet
/model opus             # Mudar para Opus

# ConfiguraÃ§Ã£o
/config                  # Abrir configuraÃ§Ãµes
/hooks                   # Gerenciar hooks
/agents                  # Gerenciar subagentes
/mcp                     # Gerenciar MCPs

# ExecuÃ§Ã£o
!<comando>              # Bash mode (executar shell)
#<texto>                # Memory mode (memorizar)

# NavegaÃ§Ã£o
â†‘ (seta cima)           # HistÃ³rico de prompts
Esc                      # Interromper execuÃ§Ã£o
Ctrl+R                   # Expandir log detalhado
Shift+Tab                # Toggle Plan Mode
```

### ğŸ¯ Atalhos de Teclado (Cursor IDE)

| Atalho | AÃ§Ã£o |
|--------|------|
| `Ctrl+Esc` / `Cmd+Esc` | Abrir Claude Code |
| `Shift+Tab` | Toggle Plan/Agentic Mode |
| `Alt+Ctrl+K` | Adicionar arquivo como referÃªncia |
| `Esc` | Cancelar operaÃ§Ã£o |
| `â†‘` / `â†“` | Navegar histÃ³rico |
| `Ctrl+R` | Expandir detalhes |

### ğŸ“š Recursos Importantes

#### DocumentaÃ§Ã£o Oficial
- [Claude Code Overview](https://docs.anthropic.com/en/docs/claude-code/overview)
- [Quickstart Guide](https://docs.anthropic.com/en/docs/claude-code/quickstart)
- [CLI Reference](https://docs.anthropic.com/en/docs/claude-code/cli-reference)
- [Hooks Documentation](https://docs.anthropic.com/en/docs/claude-code/hooks)

#### PadrÃµes e EspecificaÃ§Ãµes
- [agents.md Standard](https://agents.md.def)
- [MCP Protocol](https://modelcontextprotocol.io)

#### Ferramentas Complementares
- [Cursor IDE](https://cursor.sh)
- [Claudia UI](https://github.com/saoudrizwan/claude-dev)
- [Supercloud](https://github.com/supercloudhq/supercloud)
- [cc-undo](https://github.com/cyanheads/cc-undo)
- [SuperWhisper](https://superwhisper.com)

---

## ğŸ“ ConclusÃ£o e PrÃ³ximos Passos

### ğŸš€ Caminho de Aprendizado

**NÃ­vel 1: BÃ¡sico (Semana 1)**
- âœ… InstalaÃ§Ã£o e setup
- âœ… Comandos bÃ¡sicos (`/init`, `/clear`, `!comando`)
- âœ… Criar primeiro `agents.md`
- âœ… Implementar feature simples

**NÃ­vel 2: IntermediÃ¡rio (Semana 2-3)**
- âœ… Configurar hooks (type check, linter)
- âœ… Criar comandos customizados
- âœ… Usar Plan Mode consistentemente
- âœ… Workflow de PR review

**NÃ­vel 3: AvanÃ§ado (MÃªs 1-2)**
- âœ… Criar e usar subagentes
- âœ… Multi-agent setup
- âœ… RefatoraÃ§Ã£o cirÃºrgica
- âœ… IntegraÃ§Ã£o com MCP servers

**NÃ­vel 4: Expert (MÃªs 3+)**
- âœ… Encadeamento de subagentes
- âœ… Workflows complexos automatizados
- âœ… Contribuir com padrÃµes da comunidade
- âœ… Criar ferramentas e extensÃµes prÃ³prias

### ğŸ’¡ Dicas Finais

1. **Comece simples**: NÃ£o tente implementar tudo de uma vez
2. **Documente seu processo**: Compartilhe aprendizados com a equipe
3. **Itere constantemente**: Refine seus prompts e workflows
4. **Mantenha seguranÃ§a em mente**: Revise sempre o cÃ³digo gerado
5. **Aprenda com a comunidade**: GitHub, Discord, Reddit

### ğŸ¤ Contribuindo

Este guia Ã© um documento vivo. Para contribuir:
- Abra issues com sugestÃµes
- Compartilhe seus workflows
- Reporte erros ou desatualizaÃ§Ãµes
- Sugira novos tÃ³picos

---

**Ãšltima atualizaÃ§Ã£o**: Outubro 2025
**VersÃ£o**: 1.0
**LicenÃ§a**: CC BY-SA 4.0

---

*Desenvolvido com â¤ï¸ pela comunidade Claude Code*